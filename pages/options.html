<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Web-Monitor Options</title>
    <link rel="stylesheet" href="../libs/element-ui.css">
    <script src="../libs/vue.js"></script>
    <script src="../libs/element-ui.js"></script>
    <script src="../libs/jquery.min.js"></script>
    <script src="../src/runner.js"></script>
  </head>
  <body>
    <div>
      <h2>Options Page</h2>
      <div id="root">
            <el-form ref="form" :model="form" label-width="80px">
                <el-form-item label="请求地址">
                    <el-input v-model="form.url"></el-input>
                </el-form-item>
                <el-form-item label="解析规则">
                    <el-input type="textarea" :rows="16" v-model="form.parserCode"></el-input>
                </el-form-item>
                <el-form-item label="返回类型">
                    <el-select v-model="form.type" placeholder="请选择">
                        <el-option
                            key="text"
                            label="text"
                            value="json">
                        </el-option>
                        <el-option
                            key="json"
                            label="json"
                            value="json">
                        </el-option>
                    </el-select>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" :loading="loading" @click="testFetchContent">测试</el-button>
                    <el-button @click="emptyResults">清空查询结果</el-button>
                </el-form-item>
                <el-form-item>
                    <el-table
                        v-if="!isMocking && results.length > 0"
                        :data="results"
                        style="width: 100%"
                    >
                        <el-table-column
                            prop="key"
                            label="key"
                        >
                        </el-table-column>
                        <el-table-column
                            prop="title"
                            label="标题"
                        >
                        </el-table-column>
                        <el-table-column
                            prop="content"
                            label="内容"
                        >
                        </el-table-column>
                    </el-table>
                </el-form-item>
                <el-form-item label="通知规则">
                    <el-input
                        type="textarea"
                        :rows="16"
                        v-model="form.notifyCode"
                    ></el-input>
                </el-form-item>
                <el-form-item v-loading="loading">
                    <el-row v-if="isMocking" :gutter="20">
                        <el-col :span="12">
                            <span>旧内容</span>
                            <el-table
                                :data="results"
                                style="width: 100%"
                            >
                                <el-table-column
                                    prop="key"
                                    label="key"
                                >
                                </el-table-column>
                                <el-table-column
                                    prop="title"
                                    label="标题"
                                >
                                </el-table-column>
                                <el-table-column
                                    prop="message"
                                    label="内容"
                                >
                                </el-table-column>
                            </el-table>
                        </el-col>
                        <el-col :span="12">
                            <span>新内容</span><el-button type="text" @click="addChild">新增记录</el-button>
                            <el-table
                                :data="mockData"
                                style="width: 100%"
                            >
                                <el-table-column
                                    prop="key"
                                    label="key"
                                >
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.key"></el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                    prop="title"
                                    label="标题"
                                >
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.title"></el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column
                                    prop="message"
                                    label="内容"
                                >
                                    <template slot-scope="scope">
                                        <el-input v-model="scope.row.message"></el-input>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作">
                                    <template slot-scope="scope">
                                        <el-button
                                            size="mini"
                                            type="danger"
                                            @click="handleDelete(scope.$index, scope.row)"
                                        >删除
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-col>
                    </el-row>
                </el-form-item>
                <el-form-item>
                    <el-button type="primary" :loading="loading" @click="mockChildren">Mock 数据</el-button>
                    <el-button v-if="isMocking" type="primary" :loading="loading" @click="showCompareResult">对比结果</el-button>
                </el-form-item>
                <el-form-item label="请求间隔">
                    <el-input
                        v-model="form.sleep"
                        min="5000"
                        placeholder="最小 5000"
                    ></el-input>
                </el-form-item>
                <el-form-item label="次数限制">
                    <el-input
                        v-model="form.limit"
                        placeholder="不填表示不限制"
                    ></el-input>
                </el-form-item>
            </el-form>
            <el-dialog
                title="对比结果"
                width="60%"
                :visible.sync="visible"
            >
                <pre>{{infos}}</pre>
                <pre>{{updates}}</pre>
                <span slot="footer" class="dialog-footer">
                    <el-button @click="visible = false">取消</el-button>
                    <el-button type="primary" @click="notify">发送通知</el-button>
                </span>
            </el-dialog>
        </div>
    </div>
    <script src="../src/options.js"></script>
  </body>
</html>
